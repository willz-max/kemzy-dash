<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Platform</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00d4aa;
            --primary-hover: #00b896;
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-card: #333333;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #444444;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --primary-color: #00a2ff;
            --primary-hover: #0088cc;
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .trading-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .chart-container {
            height: 500px;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px var(--shadow);
        }

        .order-panel {
            background-color: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px var(--shadow);
            height: 100%;
        }

        .btn-buy {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-weight: 600;
        }

        .btn-buy:hover {
            background-color: var(--primary-hover);
        }

        .btn-sell {
            background-color: #ff4d4d;
            color: white;
            border: none;
            font-weight: 600;
        }

        .btn-sell:hover {
            background-color: #e04444;
        }

        .form-control, .form-select {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(0, 212, 170, 0.25);
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px var(--shadow);
        }

        .card-header {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .table {
            color: var(--text-primary);
        }

        .table-striped>tbody>tr:nth-of-type(odd)>* {
            background-color: rgba(0, 212, 170, 0.05);
        }

        .theme-switcher {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: var(--bg-card);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .price-display {
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid trading-container">
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="text-center mb-0">Trading Platform</h2>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-8">
                <div class="chart-container" id="tradingview-chart"></div>
            </div>
            <div class="col-lg-4 mt-3 mt-lg-0">
                <div class="order-panel">
                    <h4 class="mb-4 text-center">Trade Panel</h4>
                    
                    <div class="mb-3">
                        <label class="form-label">Asset Category</label>
                        <select class="form-select" id="assetCategory">
                            <option value="">Select Category</option>
                            <option value="Bonds">Bonds</option>
                            <option value="Stocks">Stocks</option>
                            <option value="Indices">Indices</option>
                            <option value="Commodities">Commodities</option>
                            <option value="Forex">Forex</option>
                            <option value="ETFs">ETFs</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Asset</label>
                        <select class="form-select" id="assetSelect" disabled>
                            <option value="">Select an asset category first</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Timeframe</label>
                        <select class="form-select" id="timeframe">
                            <option value="10">10s</option>
                            <option value="30">30s</option>
                            <option value="60">1m</option>
                            <option value="300">5m</option>
                            <option value="1800">30m</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Order Type</label>
                        <select class="form-select" id="orderType">
                            <option value="market">Market Order</option>
                            <option value="limit">Limit Order</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="limitPriceContainer" style="display: none;">
                        <label class="form-label">Limit Price</label>
                        <input type="number" class="form-control" id="limitPrice" step="0.00001">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Amount (USD)</label>
                        <input type="number" class="form-control" id="orderAmount" value="100">
                    </div>
                    
                    <div class="price-display">
                        <span id="currentPrice">- - -</span>
                    </div>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-buy btn-lg py-3" id="buyBtn">
                            <i class="fas fa-arrow-up me-2"></i> BUY
                        </button>
                        <button class="btn btn-sell btn-lg py-3" id="sellBtn">
                            <i class="fas fa-arrow-down me-2"></i> SELL
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Trade History</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped mb-0">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Asset</th>
                                        <th>Type</th>
                                        <th>Amount (USD)</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="tradeHistory">
                                    <tr>
                                        <td colspan="5" class="text-center py-4">No trades yet</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme switcher button -->
    <div class="theme-switcher" id="themeSwitcher">
        <i class="fas fa-moon"></i>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // Theme detection and switching
        (function () {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeSwitcher = document.getElementById('themeSwitcher');
            const themeIcon = themeSwitcher.querySelector('i');
            
            // Set initial icon
            if (savedTheme === 'light') {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            themeSwitcher.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Update TradingView theme if widget exists
                if (window.tvWidget) {
                    window.tvWidget.changeTheme(newTheme === 'dark' ? 'Dark' : 'Light');
                }
                
                // Toggle icon
                themeIcon.classList.toggle('fa-moon');
                themeIcon.classList.toggle('fa-sun');
            });
        })();

        // Asset data
        const assets = {
            Bonds: ['US 10Y Treasury', 'US 30Y Treasury', 'UK 10Y Gilt', 'German 10Y Bund'],
            Stocks: ['Apple (AAPL)', 'Microsoft (MSFT)', 'Tesla (TSLA)', 'Amazon (AMZN)', 'Google (GOOGL)'],
            Indices: ['S&P 500', 'NASDAQ', 'FTSE 100', 'DAX', 'Nikkei 225'],
            Commodities: ['Gold', 'Silver', 'Crude Oil', 'Natural Gas', 'Copper'],
            Forex: ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD', 'USD/CAD'],
            ETFs: ['SPDR S&P 500 (SPY)', 'Invesco QQQ (QQQ)', 'iShares Gold Trust (IAU)']
        };

        // TradingView symbol mapping
        const symbolMapping = {
            'US 10Y Treasury': 'TVC:US10Y',
            'US 30Y Treasury': 'TVC:US30Y',
            'UK 10Y Gilt': 'TVC:UK10Y',
            'German 10Y Bund': 'TVC:DE10Y',
            'Apple (AAPL)': 'NASDAQ:AAPL',
            'Microsoft (MSFT)': 'NASDAQ:MSFT',
            'Tesla (TSLA)': 'NASDAQ:TSLA',
            'Amazon (AMZN)': 'NASDAQ:AMZN',
            'Google (GOOGL)': 'NASDAQ:GOOGL',
            'S&P 500': 'SP:SPX',
            'NASDAQ': 'NASDAQ:NDX',
            'FTSE 100': 'FTSE:UKX',
            'DAX': 'INDEX:DAX',
            'Nikkei 225': 'INDEX:NKY',
            'Gold': 'TVC:GOLD',
            'Silver': 'TVC:SILVER',
            'Crude Oil': 'TVC:USOIL',
            'Natural Gas': 'TVC:NATGAS',
            'Copper': 'TVC:COPPER',
            'EUR/USD': 'FX_IDC:EURUSD',
            'GBP/USD': 'FX_IDC:GBPUSD',
            'USD/JPY': 'FX_IDC:USDJPY',
            'AUD/USD': 'FX_IDC:AUDUSD',
            'USD/CAD': 'FX_IDC:USDCAD',
            'SPDR S&P 500 (SPY)': 'AMEX:SPY',
            'Invesco QQQ (QQQ)': 'NASDAQ:QQQ',
            'iShares Gold Trust (IAU)': 'AMEX:IAU'
        };

        // DOM elements
        const assetCategorySelect = document.getElementById('assetCategory');
        const assetSelect = document.getElementById('assetSelect');
        const timeframeSelect = document.getElementById('timeframe');
        const orderTypeSelect = document.getElementById('orderType');
        const limitPriceContainer = document.getElementById('limitPriceContainer');
        const limitPriceInput = document.getElementById('limitPrice');
        const orderAmountInput = document.getElementById('orderAmount');
        const currentPriceDisplay = document.getElementById('currentPrice');
        const buyBtn = document.getElementById('buyBtn');
        const sellBtn = document.getElementById('sellBtn');
        const tradeHistoryTable = document.getElementById('tradeHistory');

        // Initialize the TradingView widget
        function initTradingView(symbol) {
            if (window.tvWidget !== null) {
                window.tvWidget.remove();
                window.tvWidget = null;
            }

            const currentTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'Dark' : 'Light';

            window.tvWidget = new TradingView.widget({
                "autosize": true,
                "symbol": symbol,
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": currentTheme,
                "style": "1",
                "locale": "en",
                "toolbar_bg": "var(--bg-secondary)",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": false,
                "container_id": "tradingview-chart",
                "studies": [],
                "disabled_features": [
                    "volume_force_overlay",
                    "use_localstorage_for_settings",
                    "left_toolbar",
                    "header_widget",
                    "header_compare",
                    "header_screenshot",
                    "header_undo_redo",
                    "header_fullscreen_button",
                    "header_settings",
                    "header_indicators",
                    "header_interval_dialog_button",
                    "header_resolutions",
                    "header_saveload",
                    "header_chart_type",
                    "timeframes_toolbar"
                ],
                "enabled_features": [
                    "hide_left_toolbar_by_default"
                ],
                "overrides": {
                    "paneProperties.background": "var(--bg-card)",
                    "paneProperties.vertGridProperties.color": "var(--border-color)",
                    "paneProperties.horzGridProperties.color": "var(--border-color)",
                    "paneProperties.crossHairProperties.color": "var(--text-secondary)",
                    "mainSeriesProperties.candleStyle.upColor": "#26a69a",
                    "mainSeriesProperties.candleStyle.downColor": "#ef5350",
                    "mainSeriesProperties.candleStyle.borderUpColor": "#26a69a",
                    "mainSeriesProperties.candleStyle.borderDownColor": "#ef5350",
                    "mainSeriesProperties.candleStyle.wickUpColor": "#26a69a",
                    "mainSeriesProperties.candleStyle.wickDownColor": "#ef5350"
                }
            });

            // Simulate price updates
            simulatePriceUpdates(symbol);
        }

        // Simulate price updates for demo purposes
        function simulatePriceUpdates(symbol) {
            let basePrice = Math.random() * 100 + 50;
            currentPriceDisplay.textContent = basePrice.toFixed(5);

            // Update prices every second
            setInterval(() => {
                const change = (Math.random() - 0.5) * 0.1;
                basePrice += change;
                currentPriceDisplay.textContent = basePrice.toFixed(5);
            }, 1000);
        }

        // Populate asset dropdown based on category
        assetCategorySelect.addEventListener('change', function() {
            const category = this.value;
            assetSelect.disabled = !category;
            
            if (category) {
                assetSelect.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select Asset';
                assetSelect.appendChild(defaultOption);
                
                assets[category].forEach(asset => {
                    const option = document.createElement('option');
                    option.value = asset;
                    option.textContent = asset;
                    assetSelect.appendChild(option);
                });
            } else {
                assetSelect.innerHTML = '<option value="">Select an asset category first</option>';
            }
        });

        // Update chart when asset is selected
        assetSelect.addEventListener('change', function() {
            if (this.value) {
                const symbol = symbolMapping[this.value];
                if (symbol) {
                    initTradingView(symbol);
                }
            }
        });

        // Show/hide limit price input based on order type
        orderTypeSelect.addEventListener('change', function() {
            if (this.value === 'limit') {
                limitPriceContainer.style.display = 'block';
            } else {
                limitPriceContainer.style.display = 'none';
            }
        });

        // Handle buy order
        buyBtn.addEventListener('click', function() {
            placeOrder('buy');
        });

        // Handle sell order
        sellBtn.addEventListener('click', function() {
            placeOrder('sell');
        });

        // Place an order
        function placeOrder(type) {
            const assetCategory = assetCategorySelect.value;
            const asset = assetSelect.value;
            const amount = orderAmountInput.value;
            const orderType = orderTypeSelect.value;
            const limitPrice = orderType === 'limit' ? limitPriceInput.value : null;
            
            if (!assetCategory || !asset || !amount) {
                alert('Please fill all required fields');
                return;
            }
            
            // In a real app, you would send this to your backend
            console.log(`Placing ${type} order:`, {
                assetCategory,
                asset,
                amount,
                orderType,
                limitPrice
            });
            
            // Add to trade history
            addToTradeHistory(type, asset, amount);
            
            // Show confirmation
            alert(`${type.toUpperCase()} order placed for ${amount} USD of ${asset}`);
        }

        // Add trade to history table
        function addToTradeHistory(type, asset, amount) {
            // Remove the "no trades" row if it exists
            if (tradeHistoryTable.querySelector('td[colspan]')) {
                tradeHistoryTable.innerHTML = '';
            }
            
            const now = new Date();
            const dateStr = now.toLocaleString();
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td>${asset}</td>
                <td><span class="badge ${type === 'buy' ? 'bg-success' : 'bg-danger'}">${type === 'buy' ? 'BUY' : 'SELL'}</span></td>
                <td>$${amount}</td>
                <td><span class="badge bg-primary">Completed</span></td>
            `;
            
            tradeHistoryTable.prepend(row);
        }

        // Initialize with default values
        window.addEventListener('load', function() {
            assetCategorySelect.value = 'Forex';
            assetCategorySelect.dispatchEvent(new Event('change'));
            assetSelect.value = 'GBP/USD';
            assetSelect.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>